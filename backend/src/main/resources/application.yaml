# ========================
# ArchiGenTN - Configuration principale
# ========================
# Profils disponibles: dev, docker, prod

spring:
  application:
    name: archigentn

  # Profil par defaut
  profiles:
    active: dev

  # Jackson (JSON)
  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false

  # Flyway migrations - desactive pour MVP (pas de DB requise pour les endpoints stateless)
  flyway:
    enabled: false
    locations: classpath:db/migration
    baseline-on-migrate: true

  # Datasource - optionnel pour MVP (endpoints stateless)
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration
      - org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration
      - org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration

  # Servlet
  servlet:
    multipart:
      max-file-size: 50MB
      max-request-size: 50MB

# Springdoc / Swagger UI
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
    display-request-duration: true

# Actuator (health checks)
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when-authorized

# Application custom properties
archigentn:
  # TODO: Configurer la cle API IA
  ai:
    api-key: ${AI_API_KEY:}
    model: ${AI_MODEL:claude-sonnet-4-5-20250929}
    api-url: ${AI_API_URL:https://api.anthropic.com/v1/messages}
    max-tokens: ${AI_MAX_TOKENS:4096}
    temperature: ${AI_TEMPERATURE:0.3}
    timeout: ${AI_TIMEOUT:60}
  # Repertoire de sortie des fichiers generes (DXF, rendus 3D)
  output:
    directory: ${OUTPUT_DIR:./output}
  # Chemin vers les scripts Python
  scripts:
    python-path: ${PYTHON_PATH:python}
    scripts-directory: ${SCRIPTS_DIR:../scripts}

---
# ========================
# Profil: dev (developpement local)
# ========================
spring:
  config:
    activate:
      on-profile: dev

  datasource:
    url: jdbc:postgresql://localhost:5432/archigentn
    username: postgres
    password: password
    driver-class-name: org.postgresql.Driver

  jooq:
    sql-dialect: postgres

server:
  port: 8080

# CORS permissif en dev
archigentn:
  cors:
    allowed-origins: http://localhost:3000

logging:
  level:
    tn.archigen: DEBUG
    org.jooq: DEBUG

---
# ========================
# Profil: docker (docker-compose)
# ========================
spring:
  config:
    activate:
      on-profile: docker

  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://postgres:5432/archigentn}
    username: ${SPRING_DATASOURCE_USERNAME:archigen}
    password: ${SPRING_DATASOURCE_PASSWORD:archigen_dev_2024}
    driver-class-name: org.postgresql.Driver

  jooq:
    sql-dialect: postgres

server:
  port: 8080

archigentn:
  cors:
    allowed-origins: http://localhost:3000
  scripts:
    python-path: python3
    scripts-directory: /app/scripts

---
# ========================
# Profil: prod (production)
# ========================
spring:
  config:
    activate:
      on-profile: prod

  datasource:
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5

  jooq:
    sql-dialect: postgres

server:
  port: 8080

archigentn:
  cors:
    allowed-origins: ${CORS_ALLOWED_ORIGINS:https://app.archigentn.tn}

logging:
  level:
    tn.archigen: INFO
    org.jooq: WARN
